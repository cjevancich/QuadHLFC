#!/usr/bin/env python
"""
QuadHLFC - The High-Level Flight Controller for QuadCopter
Copyright (c) 2012 Greg Haynes

This program is free software: you can redistribute it and/or
modify it under the terms of the GNU General Public License as
published by the Free Software Foundation, either version 3 of the
License, or (at your option) any later version.

This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
"""

import struct
import logging

from quadhlfc.core import evloop
from quadhlfc.core import controlgw
from quadhlfc.core import pubsub

from optparse import OptionParser

if __name__=='__main__':
	# Setup the option parser
	use = "Usage: %prog [-options]"
	parser = OptionParser(usage=use)
	parser.add_option('-s', '--noserial', dest="noserial", action="store_true", default=False, help="Disable serial")
	(options, args) = parser.parse_args()

	if not options.noserial:
		from quadhlfc.core import llfc	
		lfc = llfc.Llfc('/dev/ttyUSB0', 57600, pubsub.PubSubServer('', 8090))
	else:
		lfc = None

	logging.basicConfig(level=logging.DEBUG)
	cgw = controlgw.ControlGw('localhost', 8091, lfc)
	evloop.EventDispatcher().loop_forever()

